<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        h2 {
            margin-top: 20px;
        }
        label {
            display: block;
            margin: 10px 0 5px;
        }
        input, textarea {
            width: 100%;
            max-width: 500px;
            padding: 8px;
        }
        button {
            margin-top: 10px;
            padding: 10px 20px;
            background-color: #000;
            color: #fff;
            border: none;
            cursor: pointer;
        }
        #preview {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <h1>Admin Dashboard</h1>

    <h2>Style Settings</h2>
    <label for="font">Font (e.g., Arial, sans-serif):</label>
    <input type="text" id="font" oninput="updatePreview()">
    <label for="fontSize">Font Size (e.g., 16):</label>
    <input type="number" id="fontSize" oninput="updatePreview()">
    <label for="image">Image URL (e.g., https://example.com/logo.png):</label>
    <input type="text" id="image" oninput="updatePreview()">

    <h2>Live Preview</h2>
    <div id="preview">Preview text will appear here.</div>

    <h2>Sentence Template</h2>
    <textarea id="template" rows="4" cols="50">
My favorite clothing brand is [brand] and it is owned by [owner] and their average garment is produced for $[avg_cost] by [labor_conditions] workers in [country].
    </textarea>

    <h2>Google Sheets URL</h2>
    <label for="sheetUrl">Paste Google Sheets URL:</label>
    <input type="text" id="sheetUrl" placeholder="e.g., https://docs.google.com/spreadsheets/d/...">
    <button onclick="fetchSheetData()">Load Sheet Data</button>

    <h2>Brand Data (JSON)</h2>
    <textarea id="data" rows="10" cols="50"></textarea>
    <button onclick="saveData()">Save All Changes</button>

    <script>
        async function fetchData() {
            const response = await fetch('data.json');
            return await response.json();
        }

        async function loadData() {
            const data = await fetchData();
            document.getElementById('font').value = data.font || '';
            document.getElementById('fontSize').value = data.fontSize || '';
            document.getElementById('image').value = data.image || '';
            document.getElementById('template').value = data.template || '';
            document.getElementById('data').value = JSON.stringify(data.brands, null, 2);
            updatePreview();
        }

        function updatePreview() {
            const font = document.getElementById('font').value;
            const fontSize = document.getElementById('fontSize').value;
            const image = document.getElementById('image').value;
            const preview = document.getElementById('preview');
            preview.style.fontFamily = font || 'Arial, sans-serif';
            preview.style.fontSize = fontSize ? fontSize + 'px' : '16px';
            preview.innerText = "Preview text will appear here.";
            if (image) {
                const img = document.createElement('img');
                img.src = image;
                img.style.maxWidth = '100px';
                preview.appendChild(img);
            }
        }

        async function fetchSheetData() {
            const sheetUrl = document.getElementById('sheetUrl').value;
            if (!sheetUrl) {
                alert('Please enter a Google Sheets URL.');
                return;
            }
            const sheetId = sheetUrl.match(/\/d\/(.+?)\//)[1];
            const csvUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv`;
            try {
                const response = await fetch(csvUrl);
                const csvText = await response.text();
                const json = csvToJson(csvText);
                document.getElementById('data').value = JSON.stringify(json, null, 2);
                alert('Sheet data loaded into Brand Data section.');
            } catch (e) {
                alert('Error loading sheet. Make sure itâ€™s shared publicly.');
            }
        }

        function csvToJson(csv) {
            const lines = csv.split('\n');
            const headers = lines[0].split(',').map(h => h.trim().toLowerCase().replace(/"/g, ''));
            const brands = {};
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                if (values[0]) {
                    brands[values[0]] = {
                        owner: values[1],
                        country: values[2],
                        avg_cost: parseFloat(values[3]),
                        labor_conditions: values[4]
                    };
                }
            }
            return brands;
        }

        function saveData() {
            const font = document.getElementById('font').value;
            const fontSize = document.getElementById('fontSize').value;
            const image = document.getElementById('image').value;
            const template = document.getElementById('template').value;
            const brandsText = document.getElementById('data').value;
            try {
                const brands = JSON.parse(brandsText);
                const data = {
                    font: font,
                    fontSize: fontSize,
                    image: image,
                    template: template,
                    brands: brands
                };
                alert('Copy the JSON below and paste it into data.json on GitHub:\n\n' + JSON.stringify(data, null, 2));
            } catch (e) {
                alert('Invalid JSON format in brand data.');
            }
        }

        loadData();
    </script>
</body>
</html>